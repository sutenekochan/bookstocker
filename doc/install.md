# インストール方法


## サーバに必要なものの確認
* Webサーバ (Apache等) -- 作者はApacheで確認しています
* データベース (SQLite、MySQL等) -- 作者はSQLite3で確認しています
* PHP
* PHP-DBO (使用するデータベースにあったもの)
* PHP-SimpleXML
* PHP-mbstring


## Amazon.co.jp (以下AmazonJP) のアカウントを取得
* すでに取得してあるものの使いまわしも可能です


## AmazonJP アソシエイト・プログラムへの参加
Amazonで商品が売れたときに、広告料が入る仕組みです。Amazonから商品情報を取るのに使用しています。
1. 以下のURLへ行きます https://affiliate.amazon.co.jp/
2. 「無料アカウント作成」から、新規に申し込みます。  
なお、ここでの「新規」は、アソシエイトIDを新規に申し込むことを指しています。Amazonアカウントは既存のものを使います。
3. 申請して、メールが届いたら作成完了です。  
アソシエイトIDは「-22」まで含んでIDです。-22は日本をさします。
4. (動作確認) 上記のサイトからログインして、きちんとできたかを確認します。


## Amazon.com (以下AmazonUS) のアカウントを取得 (英語)
日本のAmazonのAPIは、なぜかUSサイトで提供されているので、AmazonUSのアカウントが必要です。AmazonJPと同じメールアドレスで取る必要があります。


## Amazon Product Advertising APIの使用申請 (英語)
Amazonの広告を自分のサイトに表示するためのAPIです。APIによりAmazonから商品情報を取ってくることができます。
1. AmazonJP アソシエイトプログラムのページより、「ツール」→「Product Advertising API」を選びます。
2. アカウント作成をクリックします。ここから英語です。
3. 内容を入力してアカウントを作成します。  
Product Advertising APIはバックボーンとしてAWSを利用しているため、AWSのアカウントが作成されます。(EC2が自動的に作られるわけではありませんし、課金も発生しません)


## APIへのアクセスキーを取得 (※古い情報 --- これは使いません)
本来はProduct Advertising APIを作った時点でKeyができているはずなのですが、私がアカウントを作成した時点では、Secret Keyが見れませんでした(不具合？) そのため新規にキーを取得しました。
1. AWS の管理画面にログインします。  
IAMユーザ(一般ユーザみたいなもの)ではなく、masterアカウント(superuserみたいなもの)を使用します。
2. 右上の自分の名前が表示されているところから「セキュリティ認証情報」を選択します。  
IAMユーザの使用開始を促されますが、無視してセキュリティ認証情報に進みます。
3. 1つアクセスキーが作られていますが、これは(Secret Keyを見る方法がないため)使うことができません。そのため新規に1つ作ります。
4. アクセスキーとシークレットキーを忘れないようにメモします。  
どこかにコピペする、ダウンロードボタンでcsvを保存する等で、確実に保存してください。Secret Keyは二度と見ることができません。


## APIへのアクセスキーを取得
Product Advertising APIの認証情報と、AWSの認証情報を切り離せるようになりました。(いつの間にかなってました)
1. 以下のURLへ行きます https://affiliate.amazon.co.jp/assoc_credentials/home
2. (いままでAWSでキーを管理していた人は) 新キーに移行ボタンを押して移行させます
3. アクセスキーとシークレットキーを忘れないようにメモします。 
どこかにコピペする、ダウンロードボタンでcsvを保存する等で、確実に保存してください。Secret Keyは二度と見ることができません。



## APIの動作確認
1. 公式の scratch pad に行きます。http://webservices.amazon.co.jp/scratchpad/index.html
2. ItemLookupを選び、適当な書籍のISBNを入れて、きちんと情報が取得できるかを試します。


## Amazonからリンクボタンを取得
Amazonへのリンクに、ボタン画像を使用しています。こちらはAmazon の著作物になるため、配布物にはダミーファイルが含まれています。  
ボタンダウンロードのページからダウンロードして、imgディレクトリ内の同名の画像を置き換えます。https://affiliate.amazon.co.jp/tips/t3/a3
なお、Amazonのアソシエイトリンクボタンは、権利はAmazonに属します。「Amazonアソシエイト・プログラム運営規約」に従ってご利用ください。


## 動作環境の設定
setting.ini.php.distをsetting.ini.phpにリネームし、自分の環境にあわせて編集します。


## サーバにファイルをコピーし、パーミッションを設定
必要なものは以下のとおりです。
* *.php
* *.ini.php
* imgディレクトリ
* libディレクトリ
* styleディレクトリ
* .htaccess -- 自分の環境にあわせて書き換えてください。

書き込み可能なディレクトリの作成が必要です
* cacheディレクトリ (setting.ini.phpで設定した位置に作ります。PHP実行時の権限で書き込める必要があります)

環境によっては以下も必要になります。
* dataディレクトリ (SQLiteの場合、ここにDBファイルが作成されます。PHP実行時の権限で書き込める必要があります)

cache、dataディレクトリをpublic_htmlの中に置く場合は.htaccessを記載し、他者から閲覧できないよう設定してください。


## 動作を確認する。


